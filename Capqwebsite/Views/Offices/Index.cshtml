@model List<EF.Models.WebsiteTypeDetail>

<!-- Page Header -->
<div class="container-fluid py-1">
    <div class="container py-2">
        <div class="row align-items-center py-4">
            <div class="col-md-6 text-center text-md-right">
                <i class="fas fa-phone icon-style"></i>
                <h3 class="mb-4 mb-md-0 text-red text-uppercase output">مكاتبنا</h3>
            </div>
            <div class="col-md-6 text-center text-md-left">
                <a class="btn btn-secondary" href="Offices/Index">مكاتبنا</a>
            </div>
        </div>
    </div>
</div>

<!-- Contact -->
<div class="container-fluid">
    <div class="container">
        <div class="row">

            @if (Model != null && Model.Count > 0)
            {
                foreach (var item in Model)
                {
                    <div class="col-md-6">
                        <div class="margins">

                            <!-- Title -->
                            <article class="card2">
                                <span>@item.TitleAr</span>
                                <span class="top"></span>
                                <span class="right"></span>
                                <span class="bottom"></span>
                                <span class="left"></span>
                            </article>

                            <br />

                            <div class="row">
                                <!-- Info -->
                                <div class="col-lg-6">
                                    <div><i class="fas fa-map-marker-alt"></i> <span>العنوان</span></div>
                                    <div><i class="fas fa-phone-volume"></i> <span>الهاتف</span></div>
                                    <div><i class="fas fa-envelope"></i> <span>البريد</span></div>
                                </div>

                                <!-- Map -->
                                <div class="col-lg-6 d-flex align-items-center">
                                    <iframe class="map-frame"
                                            width="100%"
                                            height="200"
                                            style="border:0;"
                                            loading="lazy">
                                    </iframe>

                                    <!-- short link from DB -->
                                    <input type="hidden"
                                           class="map-link"
                                           value="@item.linkURL" />
                                </div>
                            </div>

                        </div>
                    </div>
                }
            }

        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    function extractLatLng(url) {

        @* // @lat,lng *@
        @* let match = url.match(/@(-?\d +\.\d +),(-?\d+\.\d+)/);  *@

        // !3dlat!4dlng
        if (!match) {
            match = url.match(/!3d(-?\d+\.\d+)!4d(-?\d+\.\d+)/);
        }

        if (!match) return null;

        return { lat: match[1], lng: match[2] };
    }

    document.querySelectorAll(".map-link").forEach((input, index) => {

        const iframe = document.querySelectorAll(".map-frame")[index];
        const shortUrl = input.value;

        fetch(shortUrl, { redirect: "follow" })
            .then(res => {
                const coords = extractLatLng(res.url);
                if (!coords) return;

                iframe.src =
                    `https://www.google.com/maps?q=${coords.lat},${coords.lng}&output=embed`;
            })
            .catch(err => console.error("Map error:", err));
    });
</script>
